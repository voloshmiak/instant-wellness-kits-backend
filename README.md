# Instant Wellness Kits - Tax Calculation System (Backend)

## üìå –û–ø–∏—Å –ø—Ä–æ—î–∫—Ç—É

–¶–µ–π –ø—Ä–æ—î–∫—Ç —î –±–µ–∫–µ–Ω–¥-—á–∞—Å—Ç–∏–Ω–æ—é —Å–∏—Å—Ç–µ–º–∏, —è–∫–∞ –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É –æ–ø–æ–¥–∞—Ç–∫—É–≤–∞–Ω–Ω—è. –í—ñ–Ω –ø—Ä–∏–π–º–∞—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (latitude, longitude) —Ç–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π `composite sales tax` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.

üîó **Frontend —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:** [https://github.com/respekttt/better-me](https://github.com/respekttt/better-me)

üîó **–ó–∞–¥–µ–ø–ª–æ—î–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫:** [https://better-me-frontend-762050733390.europe-central2.run.app](https://better-me-frontend-762050733390.europe-central2.run.app)

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π —Å—Ç–µ–∫
- **–ú–æ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è:** Golang
- **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö:** PostgreSQL
- **–•–º–∞—Ä–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** GCP (Google Cloud Platform)
- **–ó–æ–≤–Ω—ñ—à–Ω—ñ API:** Google Maps Geocoder API

## üí° –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### 1. –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Å—Ç–∞–≤–æ–∫
–î–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–º—ñ—Å—Ü–µ–≤–æ—Å—Ç—ñ) —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –ø–æ–¥–∞—Ç–∫–æ–≤—É —é—Ä–∏—Å–¥–∏–∫—Ü—ñ—é –±—É–ª–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–≤–∞ –∫–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:
- **Google Geocoder API:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è (Reverse Geocoding), —â–æ–± –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (latitude, longitude) —É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –∞–¥—Ä–µ—Å—É, –º—ñ—Å—Ç–æ —Ç–∞ –æ–∫—Ä—É–≥ (county) —à—Ç–∞—Ç—É –ù—å—é-–ô–æ—Ä–∫.
- **–ú–∞–ø—ñ–Ω–≥ –ø–æ–¥–∞—Ç–∫—ñ–≤:** –î–∞–Ω—ñ –ø—Ä–æ –ø–æ–¥–∞—Ç–∫–∏ –±—É–ª–∏ –∑–∞–≤—á–∞—Å–Ω–æ —Å–ø–∞—Ä—à–µ–Ω—ñ –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª ([New York State Sales and Use Tax Rates by Jurisdiction](https://www.tax.ny.gov/pdf/publications/sales/pub718.pdf)) —ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —É —Ñ–∞–π–ª—ñ `tax_rates.csv`. –ü—ñ–¥ —á–∞—Å —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ü—ñ –¥–∞–Ω—ñ —ñ–º–ø–æ—Ä—Ç—É—é—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—é PostgreSQL, —â–æ –¥–æ–∑–≤–æ–ª—è—î —à–≤–∏–¥–∫–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ —Å—Ç–∞–≤–∫—É –ø–æ–¥–∞—Ç–∫—É –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–æ—ó —é—Ä–∏—Å–¥–∏–∫—Ü—ñ—ó.

### 2. –û–±—Ä–æ–±–∫–∞ –≤–µ–ª–∏–∫–∏—Ö –æ–±—Å—è–≥—ñ–≤ –¥–∞–Ω–∏—Ö (CSV Import)
–Ü–º–ø–æ—Ä—Ç –∑–∞–º–æ–≤–ª–µ–Ω—å —á–µ—Ä–µ–∑ CSV-—Ñ–∞–π–ª –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –≤–µ–ª–∏–∫—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤. –î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å:
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –º–µ—Ö–∞–Ω—ñ–∑–º **back-pressure**.
- –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ñ–∞–π–ª—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–æ–¥—Ä–∞–∑—É –æ—Ç—Ä–∏–º—É—î –ø–æ–∑–∏—Ç–∏–≤–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å**, —â–æ —Ñ–∞–π–ª –ø—Ä–∏–π–Ω—è—Ç–æ –≤ –æ–±—Ä–æ–±–∫—É.
- –°–∞–º–∞ –æ–±—Ä–æ–±–∫–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —É —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ). –¶–µ –∑—É–º–æ–≤–ª–µ–Ω–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—é —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏ –¥–æ Google Geocoder API, —è–∫–∏–π –º–∞—î —Å—É–≤–æ—Ä—ñ **rate limits** (–æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É). –§–æ–Ω–æ–≤–∏–π –≤–æ—Ä–∫–µ—Ä –æ–±—Ä–æ–±–ª—è—î —á–µ—Ä–≥—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ü–∏—Ö –ª—ñ–º—ñ—Ç—ñ–≤, –ø–æ—Å—Ç—É–ø–æ–≤–æ –∑–±–∞–≥–∞—á—É—é—á–∏ –¥–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω—å —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞–º–∏ –ø–æ–¥–∞—Ç–∫—ñ–≤.

## üì° API –ï–Ω–¥–ø–æ—ó–Ω—Ç–∏

### 1. –Ü–º–ø–æ—Ä—Ç –∑–∞–º–æ–≤–ª–µ–Ω—å (CSV)
**Endpoint:** `POST /orders/import`  
**Content-Type:** `multipart/form-data`

–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î CSV —Ñ–∞–π–ª —ñ–∑ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏. –û–±—Ä–æ–±–∫–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è Google Geocoder API.

**–ó–∞–ø–∏—Ç:**
- `file`: CSV-—Ñ–∞–π–ª (–ø–æ–ª–µ —Ñ–æ—Ä–º–∏)

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** `202 Accepted`

---

### 2. –†—É—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
**Endpoint:** `POST /orders`  
**Content-Type:** `application/json`

–°—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –æ–¥—Ä–∞–∑—É —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î –ø–æ–¥–∞—Ç–æ–∫.

**–ó–∞–ø–∏—Ç:**
```json
{
  "latitude": 40.7128,
  "longitude": -74.0060,
  "subtotal": 100,
  "timestamp": "2023-10-27T10:00:00Z"
}
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** `202 Accepted`
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "latitude": 40.7128,
  "longitude": -74.0060,
  "subtotal": "100",
  "compositeTaxRate": "0.08875",
  "taxAmount": "8.875",
  "totalAmount": "108.875",
  "breakdown": {
    "stateRate": "0.04",
    "countyRate": "0.0475",
    "cityRate": "0",
    "specialRate": "0.00125"
  },
  "jurisdiction": {
    "state": "NY",
    "county": "New York",
    "city": "New York",
    "special": "Metropolitan Commuter Transportation District"
  },
  "timestamp": "2023-10-27T10:00:00Z"
}
```

---

### 3. –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –∑–∞–º–æ–≤–ª–µ–Ω—å
**Endpoint:** `GET /orders`

–ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å –∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é, —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ —Ç–∞ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é.

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞–ø–∏—Ç—É (Query Params):**
- `page` (default: 1)
- `limit` (default: 20)
- `state`, `county`, `city` ‚Äî —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –ª–æ–∫–∞—Ü—ñ—î—é
- `from`, `to` ‚Äî —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –¥–∞—Ç–æ—é (—Ñ–æ—Ä–º–∞—Ç `YYYY-MM-DD`)

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** `200 OK`
```json
{
  "orders": [
    {
       "id": "...",
       "latitude": 40.7128,
       "longitude": -74.0060,
       "subtotal": "100",
       "totalAmount": "108.875",
       ...
    }
  ],
  "pagination": {
    "total": 125,
    "page": 1,
    "limit": 20,
    "totalPages": 7
  },
  "globalTotal": {
    "orders": 125,
    "tax": "1109.375",
    "grand": "13609.375"
  },
  "last24h": {
    "orders": 5,
    "tax": "44.375",
    "grand": "544.375"
  }
}
```

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ—î–∫—Ç—É –ª–æ–∫–∞–ª—å–Ω–æ

–î–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ—î–∫—Ç—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Docker —Ç–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π bash-—Å–∫—Ä–∏–ø—Ç. –î–æ —Å–∫–ª–∞–¥—É docker-compose –≤—Ö–æ–¥—è—Ç—å –±–∞–∑–∞ –¥–∞–Ω–∏—Ö PostgreSQL, –±–µ–∫–µ–Ω–¥ —Ç–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–µ—Ä–≤—ñ—Å–∏.

1. –°–∫–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —Ç–∞ –ø–µ—Ä–µ–π–¥—ñ—Ç—å —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é:
   ```bash
   git clone https://github.com/voloshmiak/instant-wellness-kits-backend.git
   cd instant-wellness-kits-backend
   ```
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —É –≤–∞—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ Docker —Ç–∞ docker-compose.
3. –î–æ–¥–∞–π—Ç–µ –∫–ª—é—á –¥–ª—è Google Geocoder API. –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ –π–æ–≥–æ —É –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:
4. 
   ```bash
   export GEOCODING_API_KEY="–≤–∞—à_–∫–ª—é—á_google_geocoder_api"
   ```
4. –í–∏–∫–æ–Ω–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫—É:
   ```bash
   chmod +x redeploy.sh
   ./redeploy.sh
   ```
   –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä–µ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏, –≤–∏–∫–æ–Ω–∞—î –º—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ (`tax_rates.csv`).

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É:
- **–ë–µ–∫–µ–Ω–¥ (API)** –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ `http://localhost:80`
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (–ê–¥–º—ñ–Ω–∫–∞)** –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ `http://localhost:5173`
- **PostgreSQL** –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –ø–æ—Ä—Ç—É `http://localhost:5432`